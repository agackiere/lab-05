---
title: "Lab 05 - Wrangling spatial data"
author: "Anaelle Gackiere"
date: "02-13-2026"
output: github_document
---

### Load packages and data

```{r load-packages, message = FALSE}
library(tidyverse) 
library(dsbox) 
```

```{r load-data, message = FALSE}
states <- read_csv("data/states.csv")
```

### Exercise 1

```{r filter-alaska}

# Filter the Denny’s df for Alaska
dn_ak <- dennys %>%
  filter(state == "AK")
nrow(dn_ak)

# Filter the La Quinta df for Alaska
lq_ak <- laquinta %>%
  filter(state == "AK")
nrow(lq_ak)


```

There are `r nrow(dn_ak)` Denny's locations in Alaska and `r nrow(lq_ak)`La Quinta locations in Alaska. 

### Exercise 2

```{r AK-DNandLQ-pairings}
# Calculate the number of pairings using the data frames you have already made

n_pairings <- nrow(dn_ak) * nrow(lq_ak)
n_pairings

```

There are `r nrow(dn_ak) * nrow(lq_ak)` pairings to be made.

### Exercise 3

```{r join-dfs}

dn_lq_ak <- full_join(dn_ak, lq_ak,
  by = "state"
)
dn_lq_ak


```

...

### Exercise 4

There are `r nrow(dn_lq_ak)` observations in the joined dataframe. The names of the variables are address, city, state, zip, longitude, latitude (all have .x and. y, apart from state since we joined by state).

```{r check-names}
# check variable names
names(dn_lq_ak)

```

...

### Exercise 5

 We use the function mutate() from the tidyverse to add a new variable to a data frame while keeping the existing variables.

```{r haversine-earth}
haversine <- function(long1, lat1, long2, lat2, round = 3) {
  # convert to radians
  long1 <- long1 * pi / 180
  lat1 <- lat1 * pi / 180
  long2 <- long2 * pi / 180
  lat2 <- lat2 * pi / 180

  R <- 6371 # Earth mean radius in km

  a <- sin((lat2 - lat1) / 2)^2 + cos(lat1) * cos(lat2) * sin((long2 - long1) / 2)^2
  d <- R * 2 * asin(sqrt(a))

  return(round(d, round)) # distance in km
}

```
...

### Exercise 6

```{r calculate-distance}

dn_lq_ak <- dn_lq_ak %>%
  mutate(distance = haversine(longitude.x, latitude.x,
                              longitude.y, latitude.y))
        
# checking it worked                              
head(dn_lq_ak$distance)

```

...

### Exercise 7

```{r minimum-distance}
# grouby by Denny's locations + new var w info for minimum distance

dn_lq_ak_mindist <- dn_lq_ak %>%
  group_by(address.x) %>%
  mutate(distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y)) %>%
  summarize(closest = min(distance, na.rm = TRUE), .groups = "drop")

# check 
dn_lq_ak_mindist
```

...

### Exercise 8
```{r distribution-minAK}

# summary statistics
summary(dn_lq_ak_mindist)

# visualize! 
ggplot(dn_lq_ak_mindist, aes(x = closest, y = 0)) +
  geom_point(size = 3, color = "plum4") +
  labs(
    x = "Distance to nearest La Quinta (km)",
    y = "",
    title = "Distances from Denny's to Nearest La Quinta in Alaska"
  ) +
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

```

...

### Exercise 9
```{r NC}

# Filter the Denny’s df for NC
dn_nc <- dennys %>%
  filter(state == "NC")
nrow(dn_nc)

# Filter the La Quinta df for NC
lq_nc <- laquinta %>%
  filter(state == "NC")
nrow(lq_nc)

n_pairings <- nrow(dn_nc) * nrow(lq_nc)
n_pairings

dn_lq_nc <- full_join(dn_nc, lq_nc,
  by = "state"
)
dn_lq_nc

# distance
dn_lq_nc <- dn_lq_nc %>%
  mutate(distance = haversine(longitude.x, latitude.x,
                              longitude.y, latitude.y))
        
# checking it worked                              
head(dn_lq_nc$distance)


# grouby by Denny's locations + new var w info for minimum distance

dn_lq_nc_mindist <- dn_lq_nc %>%
  group_by(address.x) %>%
  mutate(distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y)) %>%
  summarize(closest = min(distance, na.rm = TRUE), .groups = "drop")

# check 
dn_lq_nc_mindist

# summary statistics
summary(dn_lq_nc_mindist)

# visualize! 
ggplot(dn_lq_nc_mindist, aes(x = closest, y = 0)) +
  geom_point(size = 3, color = "plum4") +
  labs(
    x = "Distance to nearest La Quinta (km)",
    y = "",
    title = "Distances from Denny's to Nearest La Quinta in North Carolina"
  ) +
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

```

...

### Exercise 10
```{r TX}
# Filter the Denny’s df for TX
dn_tx <- dennys %>%
  filter(state == "TX")
nrow(dn_tx)

# Filter the La Quinta df for TX
lq_tx <- laquinta %>%
  filter(state == "TX")
nrow(lq_tx)

n_pairings <- nrow(dn_tx) * nrow(lq_tx)
n_pairings

dn_lq_tx <- full_join(dn_tx, lq_tx,
  by = "state"
)
dn_lq_tx

# distance
dn_lq_tx <- dn_lq_tx %>%
  mutate(distance = haversine(longitude.x, latitude.x,
                              longitude.y, latitude.y))
        
# checking it worked                              
head(dn_lq_tx$distance)


# grouby by Denny's locations + new var w info for minimum distance

dn_lq_tx_mindist <- dn_lq_tx %>%
  group_by(address.x) %>%
  mutate(distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y)) %>%
  summarize(closest = min(distance, na.rm = TRUE), .groups = "drop")

# check 
dn_lq_tx_mindist

# summary statistics
summary(dn_lq_tx_mindist)

# visualize! 
ggplot(dn_lq_tx_mindist, aes(x = closest, y = 0)) +
  geom_point(size = 3, color = "plum4") +
  labs(
    x = "Distance to nearest La Quinta (km)",
    y = "",
    title = "Distances from Denny's to Nearest La Quinta in Texas"
  ) +
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

```

...

### Exercise 11
```{r CA}
# Filter the Denny’s df for CA
dn_ca <- dennys %>%
  filter(state == "CA")
nrow(dn_ca)

# Filter the La Quinta df for CA
lq_ca <- laquinta %>%
  filter(state == "CA")
nrow(lq_ca)

n_pairings <- nrow(dn_ca) * nrow(lq_ca)
n_pairings

dn_lq_ca <- full_join(dn_ca, lq_ca,
  by = "state"
)
dn_lq_ca

# distance
dn_lq_ca <- dn_lq_ca %>%
  mutate(distance = haversine(longitude.x, latitude.x,
                              longitude.y, latitude.y))
        
# checking it worked                              
head(dn_lq_ca$distance)


# grouby by Denny's locations + new var w info for minimum distance

dn_lq_ca_mindist <- dn_lq_ca %>%
  group_by(address.x) %>%
  mutate(distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y)) %>%
  summarize(closest = min(distance, na.rm = TRUE), .groups = "drop")

# check 
dn_lq_ca_mindist

# summary statistics
summary(dn_lq_ca_mindist)

# visualize! 
ggplot(dn_lq_ca_mindist, aes(x = closest, y = 0)) +
  geom_point(size = 3, color = "plum4") +
  labs(
    x = "Distance to nearest La Quinta (km)",
    y = "",
    title = "Distances from Denny's to Nearest La Quinta in Alaska"
  ) +
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank())




```

...

### Exercise 12

Among the states you examined, where is Mitch Hedberg’s joke most likely to hold true? Explain your reasoning
...





